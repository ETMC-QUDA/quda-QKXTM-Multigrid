#define g1_00_re G1_0.x
#define g1_00_im G1_0.y
#define g1_01_re G1_1.x
#define g1_01_im G1_1.y
#define g1_02_re G1_2.x
#define g1_02_im G1_2.y
#define g1_10_re G1_3.x
#define g1_10_im G1_3.y
#define g1_11_re G1_4.x
#define g1_11_im G1_4.y
#define g1_12_re G1_5.x
#define g1_12_im G1_5.y
#define g1_20_re G1_6.x
#define g1_20_im G1_6.y
#define g1_21_re G1_7.x
#define g1_21_im G1_7.y
#define g1_22_re G1_8.x
#define g1_22_im G1_8.y

#define g1_T00_re (+g1_00_re)
#define g1_T00_im (-g1_00_im)
#define g1_T01_re (+g1_10_re)
#define g1_T01_im (-g1_10_im)
#define g1_T02_re (+g1_20_re)
#define g1_T02_im (-g1_20_im)
#define g1_T10_re (+g1_01_re)
#define g1_T10_im (-g1_01_im)
#define g1_T11_re (+g1_11_re)
#define g1_T11_im (-g1_11_im)
#define g1_T12_re (+g1_21_re)
#define g1_T12_im (-g1_21_im)
#define g1_T20_re (+g1_02_re)
#define g1_T20_im (-g1_02_im)
#define g1_T21_re (+g1_12_re)
#define g1_T21_im (-g1_12_im)
#define g1_T22_re (+g1_22_re)
#define g1_T22_im (-g1_22_im)
///////////////////////////////////////////////////
#define g2_00_re G2_0.x
#define g2_00_im G2_0.y
#define g2_01_re G2_1.x
#define g2_01_im G2_1.y
#define g2_02_re G2_2.x
#define g2_02_im G2_2.y
#define g2_10_re G2_3.x
#define g2_10_im G2_3.y
#define g2_11_re G2_4.x
#define g2_11_im G2_4.y
#define g2_12_re G2_5.x
#define g2_12_im G2_5.y
#define g2_20_re G2_6.x
#define g2_20_im G2_6.y
#define g2_21_re G2_7.x
#define g2_21_im G2_7.y
#define g2_22_re G2_8.x
#define g2_22_im G2_8.y

#define g2_T00_re (+g2_00_re)
#define g2_T00_im (-g2_00_im)
#define g2_T01_re (+g2_10_re)
#define g2_T01_im (-g2_10_im)
#define g2_T02_re (+g2_20_re)
#define g2_T02_im (-g2_20_im)
#define g2_T10_re (+g2_01_re)
#define g2_T10_im (-g2_01_im)
#define g2_T11_re (+g2_11_re)
#define g2_T11_im (-g2_11_im)
#define g2_T12_re (+g2_21_re)
#define g2_T12_im (-g2_21_im)
#define g2_T20_re (+g2_02_re)
#define g2_T20_im (-g2_02_im)
#define g2_T21_re (+g2_12_re)
#define g2_T21_im (-g2_12_im)
#define g2_T22_re (+g2_22_re)
#define g2_T22_im (-g2_22_im)
/////////////////////////////////////////////////////////////////
#define g3_00_re G3_0.x
#define g3_00_im G3_0.y
#define g3_01_re G3_1.x
#define g3_01_im G3_1.y
#define g3_02_re G3_2.x
#define g3_02_im G3_2.y
#define g3_10_re G3_3.x
#define g3_10_im G3_3.y
#define g3_11_re G3_4.x
#define g3_11_im G3_4.y
#define g3_12_re G3_5.x
#define g3_12_im G3_5.y
#define g3_20_re G3_6.x
#define g3_20_im G3_6.y
#define g3_21_re G3_7.x
#define g3_21_im G3_7.y
#define g3_22_re G3_8.x
#define g3_22_im G3_8.y

#define g3_T00_re (+g3_00_re)
#define g3_T00_im (-g3_00_im)
#define g3_T01_re (+g3_10_re)
#define g3_T01_im (-g3_10_im)
#define g3_T02_re (+g3_20_re)
#define g3_T02_im (-g3_20_im)
#define g3_T10_re (+g3_01_re)
#define g3_T10_im (-g3_01_im)
#define g3_T11_re (+g3_11_re)
#define g3_T11_im (-g3_11_im)
#define g3_T12_re (+g3_21_re)
#define g3_T12_im (-g3_21_im)
#define g3_T20_re (+g3_02_re)
#define g3_T20_im (-g3_02_im)
#define g3_T21_re (+g3_12_re)
#define g3_T21_im (-g3_12_im)
#define g3_T22_re (+g3_22_re)
#define g3_T22_im (-g3_22_im)
///////////////////////////////////////////////////////
#define g4_00_re G4_0.x
#define g4_00_im G4_0.y
#define g4_01_re G4_1.x
#define g4_01_im G4_1.y
#define g4_02_re G4_2.x
#define g4_02_im G4_2.y
#define g4_10_re G4_3.x
#define g4_10_im G4_3.y
#define g4_11_re G4_4.x
#define g4_11_im G4_4.y
#define g4_12_re G4_5.x
#define g4_12_im G4_5.y
#define g4_20_re G4_6.x
#define g4_20_im G4_6.y
#define g4_21_re G4_7.x
#define g4_21_im G4_7.y
#define g4_22_re G4_8.x
#define g4_22_im G4_8.y

#define g4_T00_re (+g4_00_re)
#define g4_T00_im (-g4_00_im)
#define g4_T01_re (+g4_10_re)
#define g4_T01_im (-g4_10_im)
#define g4_T02_re (+g4_20_re)
#define g4_T02_im (-g4_20_im)
#define g4_T10_re (+g4_01_re)
#define g4_T10_im (-g4_01_im)
#define g4_T11_re (+g4_11_re)
#define g4_T11_im (-g4_11_im)
#define g4_T12_re (+g4_21_re)
#define g4_T12_im (-g4_21_im)
#define g4_T20_re (+g4_02_re)
#define g4_T20_im (-g4_02_im)
#define g4_T21_re (+g4_12_re)
#define g4_T21_im (-g4_12_im)
#define g4_T22_re (+g4_22_re)
#define g4_T22_im (-g4_22_im)
/////////////////////////////////////////////////////////////

#define READGAUGE_double(G,Tex,dir,idx,stride)				\
  G##_0  = fetch_double2(Tex, idx + (dir*9 + 0 ) * stride);	\
  G##_1  = fetch_double2(Tex, idx + (dir*9 + 1 ) * stride);	\
  G##_2  = fetch_double2(Tex, idx + (dir*9 + 2 ) * stride);	\
  G##_3  = fetch_double2(Tex, idx + (dir*9 + 3 ) * stride);	\
  G##_4  = fetch_double2(Tex, idx + (dir*9 + 4 ) * stride);	\
  G##_5  = fetch_double2(Tex, idx + (dir*9 + 5 ) * stride);	\
  G##_6  = fetch_double2(Tex, idx + (dir*9 + 6 ) * stride);	\
  G##_7  = fetch_double2(Tex, idx + (dir*9 + 7 ) * stride);	\
  G##_8  = fetch_double2(Tex, idx + (dir*9 + 8 ) * stride);	

#define READVECTOR_double(S,Tex,idx,stride)			\
  S##_0 = fetch_double2(Tex, idx +  0  * stride);	\
  S##_1 = fetch_double2(Tex, idx +  1  * stride);	\
  S##_2 = fetch_double2(Tex, idx +  2  * stride);	\
  S##_3 = fetch_double2(Tex, idx +  3  * stride);	\
  S##_4 = fetch_double2(Tex, idx +  4  * stride);	\
  S##_5 = fetch_double2(Tex, idx +  5  * stride);	\
  S##_6 = fetch_double2(Tex, idx +  6  * stride);	\
  S##_7 = fetch_double2(Tex, idx +  7  * stride);	\
  S##_8 = fetch_double2(Tex, idx +  8  * stride);	\
  S##_9 = fetch_double2(Tex, idx +  9  * stride);	\
  S##_10 = fetch_double2(Tex, idx +  10  * stride);	\
  S##_11 = fetch_double2(Tex, idx +  11  * stride);	\


#define READPROPGAUGE_double(G,Tex,mu,nu,idx,stride)				\
  G##_0  = fetch_double2(Tex, idx + ((mu*4+nu)*9 + 0 ) * stride);	\
  G##_1  = fetch_double2(Tex, idx + ((mu*4+nu)*9 + 1 ) * stride);	\
  G##_2  = fetch_double2(Tex, idx + ((mu*4+nu)*9 + 2 ) * stride);	\
  G##_3  = fetch_double2(Tex, idx + ((mu*4+nu)*9 + 3 ) * stride);	\
  G##_4  = fetch_double2(Tex, idx + ((mu*4+nu)*9 + 4 ) * stride);	\
  G##_5  = fetch_double2(Tex, idx + ((mu*4+nu)*9 + 5 ) * stride);	\
  G##_6  = fetch_double2(Tex, idx + ((mu*4+nu)*9 + 6 ) * stride);	\
  G##_7  = fetch_double2(Tex, idx + ((mu*4+nu)*9 + 7 ) * stride);	\
  G##_8  = fetch_double2(Tex, idx + ((mu*4+nu)*9 + 8 ) * stride);	

#define DIRECTREADPROP_double(G,PROP,mu,nu,idx,stride)				\
  G##_0  = PROP[ idx + ((mu*4+nu)*9 + 0 ) * stride];	\
  G##_1  = PROP[ idx + ((mu*4+nu)*9 + 1 ) * stride];	\
  G##_2  = PROP[ idx + ((mu*4+nu)*9 + 2 ) * stride];	\
  G##_3  = PROP[ idx + ((mu*4+nu)*9 + 3 ) * stride];	\
  G##_4  = PROP[ idx + ((mu*4+nu)*9 + 4 ) * stride];	\
  G##_5  = PROP[ idx + ((mu*4+nu)*9 + 5 ) * stride];	\
  G##_6  = PROP[ idx + ((mu*4+nu)*9 + 6 ) * stride];	\
  G##_7  = PROP[ idx + ((mu*4+nu)*9 + 7 ) * stride];	\
  G##_8  = PROP[ idx + ((mu*4+nu)*9 + 8 ) * stride];	

////////////////////////////////////////////////////////////////////////////////////
#define READGAUGE_float(G,Tex,dir,idx,stride)				\
  G##_0  = fetch_float2(Tex, idx + (dir*9 + 0 ) * stride);	\
  G##_1  = fetch_float2(Tex, idx + (dir*9 + 1 ) * stride);	\
  G##_2  = fetch_float2(Tex, idx + (dir*9 + 2 ) * stride);	\
  G##_3  = fetch_float2(Tex, idx + (dir*9 + 3 ) * stride);	\
  G##_4  = fetch_float2(Tex, idx + (dir*9 + 4 ) * stride);	\
  G##_5  = fetch_float2(Tex, idx + (dir*9 + 5 ) * stride);	\
  G##_6  = fetch_float2(Tex, idx + (dir*9 + 6 ) * stride);	\
  G##_7  = fetch_float2(Tex, idx + (dir*9 + 7 ) * stride);	\
  G##_8  = fetch_float2(Tex, idx + (dir*9 + 8 ) * stride);	

#define READVECTOR_float(S,Tex,idx,stride)			\
  S##_0 = fetch_float2(Tex, idx +  0  * stride);	\
  S##_1 = fetch_float2(Tex, idx +  1  * stride);	\
  S##_2 = fetch_float2(Tex, idx +  2  * stride);	\
  S##_3 = fetch_float2(Tex, idx +  3  * stride);	\
  S##_4 = fetch_float2(Tex, idx +  4  * stride);	\
  S##_5 = fetch_float2(Tex, idx +  5  * stride);	\
  S##_6 = fetch_float2(Tex, idx +  6  * stride);	\
  S##_7 = fetch_float2(Tex, idx +  7  * stride);	\
  S##_8 = fetch_float2(Tex, idx +  8  * stride);	\
  S##_9 = fetch_float2(Tex, idx +  9  * stride);	\
  S##_10 = fetch_float2(Tex, idx +  10  * stride);	\
  S##_11 = fetch_float2(Tex, idx +  11  * stride);	\


#define READPROPGAUGE_float(G,Tex,mu,nu,idx,stride)				\
  G##_0  = fetch_float2(Tex, idx + ((mu*4+nu)*9 + 0 ) * stride);	\
  G##_1  = fetch_float2(Tex, idx + ((mu*4+nu)*9 + 1 ) * stride);	\
  G##_2  = fetch_float2(Tex, idx + ((mu*4+nu)*9 + 2 ) * stride);	\
  G##_3  = fetch_float2(Tex, idx + ((mu*4+nu)*9 + 3 ) * stride);	\
  G##_4  = fetch_float2(Tex, idx + ((mu*4+nu)*9 + 4 ) * stride);	\
  G##_5  = fetch_float2(Tex, idx + ((mu*4+nu)*9 + 5 ) * stride);	\
  G##_6  = fetch_float2(Tex, idx + ((mu*4+nu)*9 + 6 ) * stride);	\
  G##_7  = fetch_float2(Tex, idx + ((mu*4+nu)*9 + 7 ) * stride);	\
  G##_8  = fetch_float2(Tex, idx + ((mu*4+nu)*9 + 8 ) * stride);	

#define DIRECTREADPROP_double(G,PROP,mu,nu,idx,stride)				\
  G##_0  = PROP[ idx + ((mu*4+nu)*9 + 0 ) * stride];	\
  G##_1  = PROP[ idx + ((mu*4+nu)*9 + 1 ) * stride];	\
  G##_2  = PROP[ idx + ((mu*4+nu)*9 + 2 ) * stride];	\
  G##_3  = PROP[ idx + ((mu*4+nu)*9 + 3 ) * stride];	\
  G##_4  = PROP[ idx + ((mu*4+nu)*9 + 4 ) * stride];	\
  G##_5  = PROP[ idx + ((mu*4+nu)*9 + 5 ) * stride];	\
  G##_6  = PROP[ idx + ((mu*4+nu)*9 + 6 ) * stride];	\
  G##_7  = PROP[ idx + ((mu*4+nu)*9 + 7 ) * stride];	\
  G##_8  = PROP[ idx + ((mu*4+nu)*9 + 8 ) * stride];	
  

#define MUL3X3(a,b,c)							\
  a##00_re =  b##00_re*c##00_re - b##00_im*c##00_im			\
    +b##01_re*c##10_re - b##01_im*c##10_im				\
    +b##02_re*c##20_re - b##02_im*c##20_im;				\
  a##00_im =  b##00_re*c##00_im + b##00_im*c##00_re			\
    +b##01_re*c##10_im + b##01_im*c##10_re				\
    +b##02_re*c##20_im + b##02_im*c##20_re;				\
  a##01_re =  b##00_re*c##01_re - b##00_im*c##01_im			\
    +b##01_re*c##11_re - b##01_im*c##11_im				\
    +b##02_re*c##21_re - b##02_im*c##21_im;				\
  a##01_im =  b##00_re*c##01_im + b##00_im*c##01_re			\
    +b##01_re*c##11_im + b##01_im*c##11_re				\
    +b##02_re*c##21_im + b##02_im*c##21_re;				\
  a##02_re =  b##00_re*c##02_re - b##00_im*c##02_im			\
    +b##01_re*c##12_re - b##01_im*c##12_im				\
    +b##02_re*c##22_re - b##02_im*c##22_im;				\
  a##02_im =  b##00_re*c##02_im + b##00_im*c##02_re			\
    +b##01_re*c##12_im + b##01_im*c##12_re				\
    +b##02_re*c##22_im + b##02_im*c##22_re;				\
  									\
  a##10_re =  b##10_re*c##00_re - b##10_im*c##00_im			\
    +b##11_re*c##10_re - b##11_im*c##10_im				\
    +b##12_re*c##20_re - b##12_im*c##20_im;				\
  a##10_im =  b##10_re*c##00_im + b##10_im*c##00_re			\
    +b##11_re*c##10_im + b##11_im*c##10_re				\
    +b##12_re*c##20_im + b##12_im*c##20_re;				\
  a##11_re =  b##10_re*c##01_re - b##10_im*c##01_im			\
    +b##11_re*c##11_re - b##11_im*c##11_im				\
    +b##12_re*c##21_re - b##12_im*c##21_im;				\
  a##11_im =  b##10_re*c##01_im + b##10_im*c##01_re			\
    +b##11_re*c##11_im + b##11_im*c##11_re				\
    +b##12_re*c##21_im + b##12_im*c##21_re;				\
  a##12_re =  b##10_re*c##02_re - b##10_im*c##02_im			\
    +b##11_re*c##12_re - b##11_im*c##12_im				\
    +b##12_re*c##22_re - b##12_im*c##22_im;				\
  a##12_im =  b##10_re*c##02_im + b##10_im*c##02_re			\
    +b##11_re*c##12_im + b##11_im*c##12_re				\
    +b##12_re*c##22_im + b##12_im*c##22_re;				\
  									\
  a##20_re =  b##20_re*c##00_re - b##20_im*c##00_im			\
    +b##21_re*c##10_re - b##21_im*c##10_im				\
    +b##22_re*c##20_re - b##22_im*c##20_im;				\
  a##20_im =  b##20_re*c##00_im + b##20_im*c##00_re			\
    +b##21_re*c##10_im + b##21_im*c##10_re				\
    +b##22_re*c##20_im + b##22_im*c##20_re;				\
  a##21_re =  b##20_re*c##01_re - b##20_im*c##01_im			\
    +b##21_re*c##11_re - b##21_im*c##11_im				\
    +b##22_re*c##21_re - b##22_im*c##21_im;				\
  a##21_im =  b##20_re*c##01_im + b##20_im*c##01_re			\
    +b##21_re*c##11_im + b##21_im*c##11_re				\
    +b##22_re*c##21_im + b##22_im*c##21_re;				\
  a##22_re =  b##20_re*c##02_re - b##20_im*c##02_im			\
    +b##21_re*c##12_re - b##21_im*c##12_im				\
    +b##22_re*c##22_re - b##22_im*c##22_im;				\
  a##22_im =  b##20_re*c##02_im + b##20_im*c##02_re			\
    +b##21_re*c##12_im + b##21_im*c##12_re				\
    +b##22_re*c##22_im + b##22_im*c##22_re;	


#define TRACEMUL3X3(b,c)						\
  b##00_re*c##00_re - b##00_im*c##00_im					\
  + b##01_re*c##10_re - b##01_im*c##10_im				\
  + b##02_re*c##20_re - b##02_im*c##20_im				\
  + b##10_re*c##01_re - b##10_im*c##01_im				\
  + b##11_re*c##11_re - b##11_im*c##11_im				\
  + b##12_re*c##21_re - b##12_im*c##21_im				\
  + b##20_re*c##02_re - b##20_im*c##02_im				\
  + b##21_re*c##12_re - b##21_im*c##12_im				\
  + b##22_re*c##22_re - b##22_im*c##22_im;				\
  

#define ADJOINTMUL3x3(a,b,c)						\
  a[0][0].x =  b[0][0].x*c[0][0].x + b[0][0].y*c[0][0].y		\
    +b[1][0].x*c[1][0].x + b[1][0].y*c[1][0].y				\
    +b[2][0].x*c[2][0].x + b[2][0].y*c[2][0].y;				\
  a[0][0].y =  b[0][0].x*c[0][0].y - b[0][0].y*c[0][0].x		\
    +b[1][0].x*c[1][0].y - b[1][0].y*c[1][0].x				\
    +b[2][0].x*c[2][0].y - b[2][0].y*c[2][0].x;				\
  a[0][1].x =  b[0][0].x*c[0][1].x + b[0][0].y*c[0][1].y		\
    +b[1][0].x*c[1][1].x + b[1][0].y*c[1][1].y				\
    +b[2][0].x*c[2][1].x + b[2][0].y*c[2][1].y;				\
  a[0][1].y =  b[0][0].x*c[0][1].y - b[0][0].y*c[0][1].x		\
    +b[1][0].x*c[1][1].y - b[1][0].y*c[1][1].x				\
    +b[2][0].x*c[2][1].y - b[2][0].y*c[2][1].x;				\
  a[0][2].x =  b[0][0].x*c[0][2].x + b[0][0].y*c[0][2].y		\
    +b[1][0].x*c[1][2].x + b[1][0].y*c[1][2].y				\
    +b[2][0].x*c[2][2].x + b[2][0].y*c[2][2].y;				\
  a[0][2].y =  b[0][0].x*c[0][2].y - b[0][0].y*c[0][2].x		\
    +b[1][0].x*c[1][2].y - b[1][0].y*c[1][2].x				\
    +b[2][0].x*c[2][2].y - b[2][0].y*c[2][2].x;				\
  									\
  a[1][0].x =  b[0][1].x*c[0][0].x + b[0][1].y*c[0][0].y		\
    +b[1][1].x*c[1][0].x + b[1][1].y*c[1][0].y				\
    +b[2][1].x*c[2][0].x + b[2][1].y*c[2][0].y;				\
  a[1][0].y =  b[0][1].x*c[0][0].y - b[0][1].y*c[0][0].x		\
    +b[1][1].x*c[1][0].y - b[1][1].y*c[1][0].x				\
    +b[2][1].x*c[2][0].y - b[2][1].y*c[2][0].x;				\
  a[1][1].x =  b[0][1].x*c[0][1].x + b[0][1].y*c[0][1].y		\
    +b[1][1].x*c[1][1].x + b[1][1].y*c[1][1].y				\
    +b[2][1].x*c[2][1].x + b[2][1].y*c[2][1].y;				\
  a[1][1].y =  b[0][1].x*c[0][1].y - b[0][1].y*c[0][1].x		\
    +b[1][1].x*c[1][1].y - b[1][1].y*c[1][1].x				\
    +b[2][1].x*c[2][1].y - b[2][1].y*c[2][1].x;				\
  a[1][2].x =  b[0][1].x*c[0][2].x + b[0][1].y*c[0][2].y		\
    +b[1][1].x*c[1][2].x + b[1][1].y*c[1][2].y				\
    +b[2][1].x*c[2][2].x + b[2][1].y*c[2][2].y;				\
  a[1][2].y =  b[0][1].x*c[0][2].y - b[0][1].y*c[0][2].x		\
    +b[1][1].x*c[1][2].y - b[1][1].y*c[1][2].x				\
    +b[2][1].x*c[2][2].y - b[2][1].y*c[2][2].x;				\
  									\
  a[2][0].x =  b[0][2].x*c[0][0].x + b[0][2].y*c[0][0].y		\
    +b[1][2].x*c[1][0].x + b[1][2].y*c[1][0].y				\
    +b[2][2].x*c[2][0].x + b[2][2].y*c[2][0].y;				\
  a[2][0].y =  b[0][2].x*c[0][0].y - b[0][2].y*c[0][0].x		\
    +b[1][2].x*c[1][0].y - b[1][2].y*c[1][0].x				\
    +b[2][2].x*c[2][0].y - b[2][2].y*c[2][0].x;				\
  a[2][1].x =  b[0][2].x*c[0][1].x + b[0][2].y*c[0][1].y		\
    +b[1][2].x*c[1][1].x + b[1][2].y*c[1][1].y				\
    +b[2][2].x*c[2][1].x + b[2][2].y*c[2][1].y;				\
  a[2][1].y =  b[0][2].x*c[0][1].y - b[0][2].y*c[0][1].x		\
    +b[1][2].x*c[1][1].y - b[1][2].y*c[1][1].x				\
    +b[2][2].x*c[2][1].y - b[2][2].y*c[2][1].x;				\
  a[2][2].x =  b[0][2].x*c[0][2].x + b[0][2].y*c[0][2].y		\
    +b[1][2].x*c[1][2].x + b[1][2].y*c[1][2].y				\
    +b[2][2].x*c[2][2].x + b[2][2].y*c[2][2].y;				\
  a[2][2].y =  b[0][2].x*c[0][2].y - b[0][2].y*c[0][2].x		\
    +b[1][2].x*c[1][2].y - b[1][2].y*c[1][2].x				\
    +b[2][2].x*c[2][2].y - b[2][2].y*c[2][2].x;


#define MULADJOINT3x3(a,b,c)						\
  a[0][0].x =  b[0][0].x*c[0][0].x + b[0][0].y*c[0][0].y		\
    +b[0][1].x*c[0][1].x + b[0][1].y*c[0][1].y				\
    +b[0][2].x*c[0][2].x + b[0][2].y*c[0][2].y;				\
  a[0][0].y = -b[0][0].x*c[0][0].y + b[0][0].y*c[0][0].x		\
    -b[0][1].x*c[0][1].y + b[0][1].y*c[0][1].x				\
    -b[0][2].x*c[0][2].y + b[0][2].y*c[0][2].x;				\
  a[0][1].x =  b[0][0].x*c[1][0].x + b[0][0].y*c[1][0].y		\
    +b[0][1].x*c[1][1].x + b[0][1].y*c[1][1].y				\
    +b[0][2].x*c[1][2].x + b[0][2].y*c[1][2].y;				\
  a[0][1].y = -b[0][0].x*c[1][0].y + b[0][0].y*c[1][0].x		\
    -b[0][1].x*c[1][1].y + b[0][1].y*c[1][1].x				\
    -b[0][2].x*c[1][2].y + b[0][2].y*c[1][2].x;				\
  a[0][2].x =  b[0][0].x*c[2][0].x + b[0][0].y*c[2][0].y		\
    +b[0][1].x*c[2][1].x + b[0][1].y*c[2][1].y				\
    +b[0][2].x*c[2][2].x + b[0][2].y*c[2][2].y;				\
  a[0][2].y = -b[0][0].x*c[2][0].y + b[0][0].y*c[2][0].x		\
    -b[0][1].x*c[2][1].y + b[0][1].y*c[2][1].x				\
    -b[0][2].x*c[2][2].y + b[0][2].y*c[2][2].x;				\
  									\
  a[1][0].x =  b[1][0].x*c[0][0].x + b[1][0].y*c[0][0].y		\
    +b[1][1].x*c[0][1].x + b[1][1].y*c[0][1].y				\
    +b[1][2].x*c[0][2].x + b[1][2].y*c[0][2].y;				\
  a[1][0].y = -b[1][0].x*c[0][0].y + b[1][0].y*c[0][0].x		\
    -b[1][1].x*c[0][1].y + b[1][1].y*c[0][1].x				\
    -b[1][2].x*c[0][2].y + b[1][2].y*c[0][2].x;				\
  a[1][1].x =  b[1][0].x*c[1][0].x + b[1][0].y*c[1][0].y		\
    +b[1][1].x*c[1][1].x + b[1][1].y*c[1][1].y				\
    +b[1][2].x*c[1][2].x + b[1][2].y*c[1][2].y;				\
  a[1][1].y = -b[1][0].x*c[1][0].y + b[1][0].y*c[1][0].x		\
    -b[1][1].x*c[1][1].y + b[1][1].y*c[1][1].x				\
    -b[1][2].x*c[1][2].y + b[1][2].y*c[1][2].x;				\
  a[1][2].x =  b[1][0].x*c[2][0].x + b[1][0].y*c[2][0].y		\
    +b[1][1].x*c[2][1].x + b[1][1].y*c[2][1].y				\
    +b[1][2].x*c[2][2].x + b[1][2].y*c[2][2].y;				\
  a[1][2].y = -b[1][0].x*c[2][0].y + b[1][0].y*c[2][0].x		\
    -b[1][1].x*c[2][1].y + b[1][1].y*c[2][1].x				\
    -b[1][2].x*c[2][2].y + b[1][2].y*c[2][2].x;				\
  									\
  a[2][0].x =  b[2][0].x*c[0][0].x + b[2][0].y*c[0][0].y		\
    +b[2][1].x*c[0][1].x + b[2][1].y*c[0][1].y				\
    +b[2][2].x*c[0][2].x + b[2][2].y*c[0][2].y;				\
  a[2][0].y = -b[2][0].x*c[0][0].y + b[2][0].y*c[0][0].x		\
    -b[2][1].x*c[0][1].y + b[2][1].y*c[0][1].x				\
    -b[2][2].x*c[0][2].y + b[2][2].y*c[0][2].x;				\
  a[2][1].x =  b[2][0].x*c[1][0].x + b[2][0].y*c[1][0].y		\
    +b[2][1].x*c[1][1].x + b[2][1].y*c[1][1].y				\
    +b[2][2].x*c[1][2].x + b[2][2].y*c[1][2].y;				\
  a[2][1].y = -b[2][0].x*c[1][0].y + b[2][0].y*c[1][0].x		\
    -b[2][1].x*c[1][1].y + b[2][1].y*c[1][1].x				\
    -b[2][2].x*c[1][2].y + b[2][2].y*c[1][2].x;				\
  a[2][2].x =  b[2][0].x*c[2][0].x + b[2][0].y*c[2][0].y		\
    +b[2][1].x*c[2][1].x + b[2][1].y*c[2][1].y				\
    +b[2][2].x*c[2][2].x + b[2][2].y*c[2][2].y;				\
  a[2][2].y = -b[2][0].x*c[2][0].y + b[2][0].y*c[2][0].x		\
    -b[2][1].x*c[2][1].y + b[2][1].y*c[2][1].x				\
    -b[2][2].x*c[2][2].y + b[2][2].y*c[2][2].x;

#define MUL3x3_2(a,b,c)							\
  a[0][0].x =  b[0][0].x*c[0][0].x - b[0][0].y*c[0][0].y		\
    +b[0][1].x*c[1][0].x - b[0][1].y*c[1][0].y				\
    +b[0][2].x*c[2][0].x - b[0][2].y*c[2][0].y;				\
  a[0][0].y =  b[0][0].x*c[0][0].y + b[0][0].y*c[0][0].x		\
    +b[0][1].x*c[1][0].y + b[0][1].y*c[1][0].x				\
    +b[0][2].x*c[2][0].y + b[0][2].y*c[2][0].x;				\
  a[0][1].x =  b[0][0].x*c[0][1].x - b[0][0].y*c[0][1].y		\
    +b[0][1].x*c[1][1].x - b[0][1].y*c[1][1].y				\
    +b[0][2].x*c[2][1].x - b[0][2].y*c[2][1].y;				\
  a[0][1].y =  b[0][0].x*c[0][1].y + b[0][0].y*c[0][1].x		\
    +b[0][1].x*c[1][1].y + b[0][1].y*c[1][1].x				\
    +b[0][2].x*c[2][1].y + b[0][2].y*c[2][1].x;				\
  a[0][2].x =  b[0][0].x*c[0][2].x - b[0][0].y*c[0][2].y		\
    +b[0][1].x*c[1][2].x - b[0][1].y*c[1][2].y				\
    +b[0][2].x*c[2][2].x - b[0][2].y*c[2][2].y;				\
  a[0][2].y =  b[0][0].x*c[0][2].y + b[0][0].y*c[0][2].x		\
    +b[0][1].x*c[1][2].y + b[0][1].y*c[1][2].x				\
    +b[0][2].x*c[2][2].y + b[0][2].y*c[2][2].x;				\
  									\
  a[1][0].x =  b[1][0].x*c[0][0].x - b[1][0].y*c[0][0].y		\
    +b[1][1].x*c[1][0].x - b[1][1].y*c[1][0].y				\
    +b[1][2].x*c[2][0].x - b[1][2].y*c[2][0].y;				\
  a[1][0].y =  b[1][0].x*c[0][0].y + b[1][0].y*c[0][0].x		\
    +b[1][1].x*c[1][0].y + b[1][1].y*c[1][0].x				\
    +b[1][2].x*c[2][0].y + b[1][2].y*c[2][0].x;				\
  a[1][1].x =  b[1][0].x*c[0][1].x - b[1][0].y*c[0][1].y		\
    +b[1][1].x*c[1][1].x - b[1][1].y*c[1][1].y				\
    +b[1][2].x*c[2][1].x - b[1][2].y*c[2][1].y;				\
  a[1][1].y =  b[1][0].x*c[0][1].y + b[1][0].y*c[0][1].x		\
    +b[1][1].x*c[1][1].y + b[1][1].y*c[1][1].x				\
    +b[1][2].x*c[2][1].y + b[1][2].y*c[2][1].x;				\
  a[1][2].x =  b[1][0].x*c[0][2].x - b[1][0].y*c[0][2].y		\
    +b[1][1].x*c[1][2].x - b[1][1].y*c[1][2].y				\
    +b[1][2].x*c[2][2].x - b[1][2].y*c[2][2].y;				\
  a[1][2].y =  b[1][0].x*c[0][2].y + b[1][0].y*c[0][2].x		\
    +b[1][1].x*c[1][2].y + b[1][1].y*c[1][2].x				\
    +b[1][2].x*c[2][2].y + b[1][2].y*c[2][2].x;				\
  									\
  a[2][0].x =  b[2][0].x*c[0][0].x - b[2][0].y*c[0][0].y		\
    +b[2][1].x*c[1][0].x - b[2][1].y*c[1][0].y				\
    +b[2][2].x*c[2][0].x - b[2][2].y*c[2][0].y;				\
  a[2][0].y =  b[2][0].x*c[0][0].y + b[2][0].y*c[0][0].x		\
    +b[2][1].x*c[1][0].y + b[2][1].y*c[1][0].x				\
    +b[2][2].x*c[2][0].y + b[2][2].y*c[2][0].x;				\
  a[2][1].x =  b[2][0].x*c[0][1].x - b[2][0].y*c[0][1].y		\
    +b[2][1].x*c[1][1].x - b[2][1].y*c[1][1].y				\
    +b[2][2].x*c[2][1].x - b[2][2].y*c[2][1].y;				\
  a[2][1].y =  b[2][0].x*c[0][1].y + b[2][0].y*c[0][1].x		\
    +b[2][1].x*c[1][1].y + b[2][1].y*c[1][1].x				\
    +b[2][2].x*c[2][1].y + b[2][2].y*c[2][1].x;				\
  a[2][2].x =  b[2][0].x*c[0][2].x - b[2][0].y*c[0][2].y		\
    +b[2][1].x*c[1][2].x - b[2][1].y*c[1][2].y				\
    +b[2][2].x*c[2][2].x - b[2][2].y*c[2][2].y;				\
  a[2][2].y =  b[2][0].x*c[0][2].y + b[2][0].y*c[0][2].x		\
    +b[2][1].x*c[1][2].y + b[2][1].y*c[1][2].x				\
    +b[2][2].x*c[2][2].y + b[2][2].y*c[2][2].x;

#define apply_U_on_S(P,U,S)				\
  P##0 = U##0 * S##0 + U##1 * S##1 + U##2 * S##2;	\
  P##1 = U##3 * S##0 + U##4 * S##1 + U##5 * S##2;       \
  P##2 = U##6 * S##0 + U##7 * S##1 + U##8 * S##2;       \
  							\
  P##3 = U##0 * S##3 + U##1 * S##4 + U##2 * S##5;	\
  P##4 = U##3 * S##3 + U##4 * S##4 + U##5 * S##5;       \
  P##5 = U##6 * S##3 + U##7 * S##4 + U##8 * S##5;       \
  							\
  P##6 = U##0 * S##6 + U##1 * S##7 + U##2 * S##8;	\
  P##7 = U##3 * S##6 + U##4 * S##7 + U##5 * S##8;       \
  P##8 = U##6 * S##6 + U##7 * S##7 + U##8 * S##8;       \
  							\
  P##9 = U##0 * S##9 + U##1 * S##10 + U##2 * S##11;	   \
  P##10 = U##3 * S##9 + U##4 * S##10 + U##5 * S##11;       \
  P##11 = U##6 * S##9 + U##7 * S##10 + U##8 * S##11;       
							
#define apply_U_DAG_on_S(P,U,S)					       \
  P##0 = conj(U##0) * S##0 + conj(U##3) * S##1 + conj(U##6) * S##2;    \
  P##1 = conj(U##1) * S##0 + conj(U##4) * S##1 + conj(U##7) * S##2;    \
  P##2 = conj(U##2) * S##0 + conj(U##5) * S##1 + conj(U##8) * S##2;    \
								       \
  P##3 = conj(U##0) * S##3 + conj(U##3) * S##4 + conj(U##6) * S##5;    \
  P##4 = conj(U##1) * S##3 + conj(U##4) * S##4 + conj(U##7) * S##5;    \
  P##5 = conj(U##2) * S##3 + conj(U##5) * S##4 + conj(U##8) * S##5;    \
								       \
  P##6 = conj(U##0) * S##6 + conj(U##3) * S##7 + conj(U##6) * S##8;    \
  P##7 = conj(U##1) * S##6 + conj(U##4) * S##7 + conj(U##7) * S##8;    \
  P##8 = conj(U##2) * S##6 + conj(U##5) * S##7 + conj(U##8) * S##8;    \
									\
  P##9 = conj(U##0) * S##9 + conj(U##3) * S##10 + conj(U##6) * S##11;	\
  P##10 = conj(U##1) * S##9 + conj(U##4) * S##10 + conj(U##7) * S##11;	\
  P##11 = conj(U##2) * S##9 + conj(U##5) * S##10 + conj(U##8) * S##11;       
							
							
